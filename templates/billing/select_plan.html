{% extends "base.html" %}
{% block title %}Plans & Usage – Labelz{% endblock %}

{% block content %}
<style>
    /* --- BILLING PAGE STYLES --- */
    
    .billing-header {
        text-align: center;
        margin-bottom: 40px;
    }
    
    .page-title {
        font-size: 2.5rem;
        font-weight: 800;
        color: #fff;
        margin-bottom: 10px;
    }
    
    .current-plan-badge {
        display: inline-block;
        background: rgba(167, 105, 237, 0.1);
        color: var(--color-primary);
        border: 1px solid rgba(167, 105, 237, 0.3);
        padding: 6px 16px;
        border-radius: 20px;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 1px;
        font-size: 0.8rem;
    }

    /* Usage Stats Grid */
    .usage-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 60px;
    }

    .usage-card {
        background: var(--color-surface);
        border: 1px solid var(--color-border);
        border-radius: var(--radius-card);
        padding: 24px;
        text-align: center;
    }
    
    .usage-label {
        font-size: 0.8rem;
        text-transform: uppercase;
        color: var(--color-muted);
        font-weight: 700;
        margin-bottom: 8px;
    }
    
    .usage-value {
        font-size: 1.8rem;
        font-weight: 800;
        color: #fff;
    }
    
    .usage-limit {
        font-size: 0.9rem;
        color: var(--color-muted);
        margin-top: 4px;
    }

    /* Pricing Section */
    .pricing-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 30px;
        max-width: 900px;
        margin: 0 auto 60px;
    }

    .price-card {
        background: var(--color-surface);
        border: 1px solid var(--color-border);
        border-radius: var(--radius-card);
        padding: 40px;
        position: relative;
        overflow: hidden;
        transition: transform 0.3s var(--ease-elastic);
        display: flex;
        flex-direction: column;
    }
    
    .price-card:hover {
        transform: translateY(-8px);
    }
    
    .price-card.featured {
        border-color: var(--color-primary);
        box-shadow: 0 0 40px rgba(167, 105, 237, 0.15);
        background: linear-gradient(180deg, rgba(167, 105, 237, 0.05) 0%, var(--color-surface) 100%);
    }
    
    .plan-name { font-size: 1.5rem; font-weight: 800; color: #fff; margin-bottom: 10px; }
    .plan-price { font-size: 2.5rem; font-weight: 900; color: #fff; margin-bottom: 20px; }
    .plan-price span { font-size: 1rem; color: var(--color-muted); font-weight: 500; }
    
    .feature-list {
        list-style: none;
        padding: 0;
        margin: 0 0 30px;
        text-align: left;
    }
    .feature-list li {
        margin-bottom: 12px;
        display: flex;
        align-items: center;
        gap: 10px;
        color: var(--color-text);
    }
    .feature-list i { color: var(--color-primary); }

    /* Enterprise Banner */
    .enterprise-banner {
        background: linear-gradient(90deg, #1a1a1a 0%, #000 100%);
        border: 1px solid var(--color-border);
        border-radius: var(--radius-card);
        padding: 40px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        flex-wrap: wrap;
        gap: 20px;
        max-width: 900px;
        margin: 0 auto;
    }

</style>

<div class="container-fluid" style="max-width: 1200px;">
    
    <!-- Header -->
    <div class="billing-header">
        <h1 class="page-title">Plans & Usage</h1>
        <div class="current-plan-badge">
            Current Plan: {{ plan_code }}
        </div>
    </div>

    <!-- Usage Stats -->
    <div class="usage-grid">
        <!-- Workspaces -->
        <div class="usage-card">
            <div class="usage-label"><i class="fa-solid fa-laptop-file me-2"></i> Workspaces</div>
            <div class="usage-value">
                {% if ws_limit is None %}∞{% else %}{{ ws_created }}{% endif %}
            </div>
            <div class="usage-limit">
                {% if ws_limit is None %}Unlimited{% else %}of {{ ws_limit }} used{% endif %}
            </div>
        </div>

        <!-- Templates -->
        <div class="usage-card">
            <div class="usage-label"><i class="fa-solid fa-pen-ruler me-2"></i> Templates</div>
            <div class="usage-value">
                {% if tpl_limit is None %}∞{% else %}{{ tpl_created }}{% endif %}
            </div>
            <div class="usage-limit">
                {% if tpl_limit is None %}Unlimited{% else %}of {{ tpl_limit }} used{% endif %}
            </div>
        </div>

        <!-- Labels -->
        <div class="usage-card" style="border-color: var(--color-accent-orange);">
            <div class="usage-label" style="color:var(--color-accent-orange);"><i class="fa-solid fa-print me-2"></i> Labels</div>
            <div class="usage-value" style="color:var(--color-accent-orange);">
                {% if lbl_limit is None %}∞{% else %}{{ lbl_used }}{% endif %}
            </div>
            <div class="usage-limit">
                {% if lbl_limit is None %}Unlimited{% else %}{{ lbl_remaining }} remaining{% endif %}
            </div>
        </div>
    </div>

    <!-- Pricing Plans -->
    <h2 class="text-center text-white mb-4 fw-bold">Available Plans</h2>
    
    <div class="pricing-grid">
        
        <!-- Starter Plan -->
        <div class="price-card">
            <div class="plan-name">Starter</div>
            <div class="plan-price">₹1900<span>/mo</span></div>
            
            <ul class="feature-list">
                <li><i class="fa-solid fa-check"></i> 1 Workspace</li>
                <li><i class="fa-solid fa-check"></i> 3 Label Templates</li>
                <li><i class="fa-solid fa-check"></i> 3,000 Labels / mo</li>
                <li><i class="fa-solid fa-check"></i> Basic Support</li>
            </ul>

            <div class="mt-auto">
                {% if can_upgrade %}
                    <form method="post" action="{% url 'billing_checkout_start' %}">
                        {% csrf_token %}
                        <input type="hidden" name="plan_code" value="STARTER">
                        <button class="btn btn-custom btn-ghost w-100">Select Starter</button>
                    </form>
                {% else %}
                    <button class="btn btn-custom btn-ghost w-100" disabled>Unavailable</button>
                {% endif %}
            </div>
        </div>

        <!-- Pro Plan -->
        <div class="price-card featured">
            <div style="position:absolute; top:0; left:50%; transform:translateX(-50%); background:var(--color-primary); color:#fff; font-size:0.7rem; font-weight:800; padding:4px 12px; border-radius:0 0 8px 8px; text-transform:uppercase; letter-spacing:1px;">Recommended</div>
            
            <div class="plan-name" style="color:var(--color-primary);">Pro</div>
            <div class="plan-price">₹6900<span>/mo</span></div>
            
            <ul class="feature-list">
                <li><i class="fa-solid fa-check"></i> <strong>Unlimited Workspaces</strong></li>
                <li><i class="fa-solid fa-check"></i> <strong>Unlimited Templates</strong></li>
                <li><i class="fa-solid fa-check"></i> <strong>30,000 Labels / mo</strong></li>
                <li><i class="fa-solid fa-check"></i> Priority Support</li>
                <li><i class="fa-solid fa-check"></i> Team Roles</li>
            </ul>

            <div class="mt-auto">
                {% if can_upgrade %}
                    <form method="post" action="{% url 'billing_checkout_start' %}">
                        {% csrf_token %}
                        <input type="hidden" name="plan_code" value="PRO">
                        <button class="btn btn-custom btn-primary-glow w-100">Upgrade to Pro</button>
                    </form>
                {% else %}
                    <button class="btn btn-custom btn-primary-glow w-100" disabled>Current / Unavailable</button>
                {% endif %}
            </div>
        </div>

    </div>

    <!-- Enterprise Banner -->
    <div class="enterprise-banner">
        <div>
            <h3 class="h4 text-white fw-bold mb-2">Need a Custom Limit?</h3>
            <p class="text mb-0">For high-volume needs, API access, or custom integrations.</p>
        </div>
        <a href="{% url 'billing_super_plan' %}" class="btn btn-custom btn-outline-secondary text-white">
            Request Super Plan <i class="fa-solid fa-arrow-right ms-2"></i>
        </a>
    </div>

</div>
{% endblock %}